(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-setting-setting"],{"2dee":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={debug:!1,isAdmin:!1,loginTypes:["weixin","username","smsCode"],agreements:{serviceUrl:"https://xxx",privacyUrl:"https://xxx",scope:["register","login","realNameVerify"]},appid:{weixin:{h5:"xxxxxx",web:"xxxxxx"}},passwordStrength:"medium",setPasswordAfterLogin:!1}},"378f":function(e,t,n){"use strict";var a=n("a4b7"),i=n.n(a);i.a},5858:function(e,t,n){"use strict";n.r(t);var a=n("ff3b"),i=n("798d");for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n("378f");var o=n("f0c5"),u=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,"0fab899b",null,!1,a["a"],void 0);t["default"]=u.exports},"798d":function(e,t,n){"use strict";n.r(t);var a=n("e977"),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=i.a},a4b7:function(e,t,n){var a=n("baef");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=n("4f06").default;i("23d4bfa4",a,!0,{sourceMap:!1,shadowMode:!1})},baef:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,".bottomBar[data-v-0fab899b]{display:flex;flex-direction:column;width:%?750?%;height:%?1000?%;justify-content:space-around;uni-button{margin:20px}}",""]),e.exports=t},da53:function(e,t,n){"use strict";(function(e){n("7a82");var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.store=t.mutations=void 0;var i=a(n("c7eb")),r=a(n("5530")),o=a(n("1da1"));n("b64b"),n("d3b7"),n("159b"),n("99af");var u=a(n("c185")),s=a(n("2dee")),c=a(n("e143")),d=e.importObject("uni-id-co"),l=e.database(),f=l.collection("uni-id-users"),p=uni.getStorageSync("uni-id-pages-userInfo")||{},v={userInfo:p,hasLogin:0!=Object.keys(p).length},g={updateUserInfo:function(){var t=arguments,n=this;return(0,o.default)((0,i.default)().mark((function a(){var o,u,s,c;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=t.length>0&&void 0!==t[0]&&t[0],!o){a.next=5;break}f.where("_id==$env.uid").update(o).then((function(e){e.result.updated?(uni.showToast({title:"更新成功",icon:"none",duration:3e3}),n.setUserInfo(o)):uni.showToast({title:"没有改变",icon:"none",duration:3e3})})),a.next=20;break;case 5:return u=e.importObject("uni-id-co",{customUI:!0}),a.prev=6,a.next=9,f.where("'_id' == $cloudEnv_uid").field("mobile,nickname,username,email,avatar_file").get();case 9:return s=a.sent,a.next=12,u.getRealNameInfo();case 12:c=a.sent,n.setUserInfo((0,r.default)((0,r.default)({},s.result.data[0]),{},{realNameAuth:c})),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](6),n.setUserInfo({},{cover:!0}),console.error(a.t0.message,a.t0.errCode);case 20:case"end":return a.stop()}}),a,null,[[6,16]])})))()},setUserInfo:function(e){var t=arguments;return(0,o.default)((0,i.default)().mark((function n(){var a,r,o;return(0,i.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.length>1&&void 0!==t[1]?t[1]:{cover:!1},r=a.cover,o=r?e:Object.assign(h.userInfo,e),h.userInfo=Object.assign({},o),h.hasLogin=0!=Object.keys(h.userInfo).length,uni.setStorageSync("uni-id-pages-userInfo",h.userInfo),n.abrupt("return",e);case 6:case"end":return n.stop()}}),n)})))()},logout:function(){var t=this;return(0,o.default)((0,i.default)().mark((function n(){return(0,i.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(e.getCurrentUserInfo().tokenExpired>Date.now())){n.next=9;break}return n.prev=1,n.next=4,d.logout();case 4:n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](1),console.error(n.t0);case 9:uni.removeStorageSync("uni_id_token"),uni.setStorageSync("uni_id_token_expired",0),uni.redirectTo({url:"/".concat(u.default.uniIdRouter&&u.default.uniIdRouter.loginPage?u.default.uniIdRouter.loginPage:"uni_modules/uni-id-pages/pages/login/login-withoutpwd")}),uni.$emit("uni-id-pages-logout"),t.setUserInfo({},{cover:!0});case 14:case"end":return n.stop()}}),n,null,[[1,6]])})))()},loginBack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.uniIdRedirectUrl,n=void 0===t?"":t,a=0,i=getCurrentPages();if(i.forEach((function(e,t){"login"==i[i.length-t-1].route.split("/")[3]&&a++})),n)return uni.redirectTo({url:n,fail:function(e){uni.switchTab({url:n,fail:function(t){console.log(e,t)}})}});if("weixin"==e.loginType)return window.history.go(-3);if(a){var r=u.default.pages[0];return uni.reLaunch({url:"/".concat(r.path)})}uni.navigateBack({delta:a})},loginSuccess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.showToast,n=void 0===t||t,a=e.toastText,i=void 0===a?"登录成功":a,r=e.autoBack,o=void 0===r||r,u=e.uniIdRedirectUrl,c=void 0===u?"":u,d=e.passwordConfirmed;if(n&&uni.showToast({title:i,icon:"none",duration:3e3}),this.updateUserInfo(),uni.$emit("uni-id-pages-login-success"),s.default.setPasswordAfterLogin&&!d)return uni.redirectTo({url:c?"/uni_modules/uni-id-pages/pages/userinfo/set-pwd/set-pwd?uniIdRedirectUrl=".concat(c,"&loginType=").concat(e.loginType):"/uni_modules/uni-id-pages/pages/userinfo/set-pwd/set-pwd?loginType=".concat(e.loginType),fail:function(e){console.log(e)}});o&&this.loginBack({uniIdRedirectUrl:c})}};t.mutations=g;var h=c.default.observable(v);t.store=h}).call(this,n("a9ff")["default"])},e03c:function(e,t,n){"use strict";(function(e){n("7a82");var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.database=void 0;var i=a(n("c7eb")),r=a(n("1da1"));n("d3b7"),n("d81d");var o=e.database(),u=o.collection("user-dynamic"),s={dynamicList:function(){return new Promise((function(e,t){u.get().then((function(t){e(t)})).catch((function(e){console.log("database err:",e),t(e)}))}))},addDynamic:function(e){return new Promise((function(t,n){u.add(e).then((function(e){t(e)})).catch((function(e){console.log(e),n(e)}))}))},cleardynamicList:function(){return(0,r.default)((0,i.default)().mark((function e(){var t;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u.get();case 2:t=e.sent,console.log("resdata:",t.result.data),t.result.data.map(function(){var e=(0,r.default)((0,i.default)().mark((function e(t){return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u.doc(t._id).remove();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})))()}};t.database=s}).call(this,n("a9ff")["default"])},e977:function(e,t,n){"use strict";(function(e){n("7a82");var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("c7eb")),r=a(n("1da1"));n("99af"),n("e9c4");var o=n("da53"),u=n("e03c"),s=e.database(),c=s.collection("uni-id-users"),d={data:function(){return{data:null,curPage:"setting"}},computed:{noLogin:function(){return!o.store.hasLogin}},methods:{toLogin:function(){uni.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withpwd?uniIdRedirectUrl=%252Fpages%252F".concat(this.curpage,"%252F").concat(this.curpage)})},logout:function(){o.mutations.logout()},getUserInfo:function(){var e=this;return(0,r.default)((0,i.default)().mark((function t(){var n,a;return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("update"),t.next=3,c.where("'_id' == $cloudEnv_uid").field("mobile,nickname,username,email,avatar_file").get();case 3:n=t.sent,console.log("fromDbData",n.result.data),uni.showToast({title:JSON.stringify(n.result.data),icon:"none",duration:1e4}),a=n.result.data[0],a.nickname.length>0&&(e.data=a);case 8:case"end":return t.stop()}}),t)})))()},clearDynamicList:function(){return(0,r.default)((0,i.default)().mark((function e(){var t;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u.database.cleardynamicList();case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})))()}}};t.default=d}).call(this,n("a9ff")["default"])},ff3b:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{},[e.noLogin?n("v-uni-button",{attrs:{type:"default"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.toLogin.apply(void 0,arguments)}}},[e._v("登录")]):n("v-uni-view",{staticClass:"bottomBar"},[n("v-uni-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getUserInfo.apply(void 0,arguments)}}},[e._v("更新个人信息")]),n("v-uni-button",{attrs:{type:"warn"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.logout.apply(void 0,arguments)}}},[e._v("退出")]),n("v-uni-button",{staticClass:"clear",attrs:{type:"warn"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clearDynamicList.apply(void 0,arguments)}}},[e._v("清理用户动态表")])],1)],1)],1)},i=[]}}]);